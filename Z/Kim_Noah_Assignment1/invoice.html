<!--Noah Kim's Assignment 1 Invoice-->

<script src="product_data.js" type="text/javascript">
    // This file will retrieve the product information from product_data.js
</script>
<script>
// Referred to lecture video from Invoice4 lecture video and Assignment1 examples 
let params = (new URL(document.location)).searchParams; // Retrieves the data (quantity, etc.) from submitPurchase and starts the purchase process 
    var quantities = []; // Creates form from the quantities and puts into an array 
    if (params.has('submitPurchase')) { // Creates loop to retrive the data
    for (i = 0; i < products.length; i++) {
    if (params.has(`quantity${i}`)) {
      a_qty = params.get(`quantity${i}`);
      quantities[i] = a_qty;
    }
  }
}
    else {
      window.location.href = './products_display.html'; // If no values in the textbox, redirect user to products_display.html to select a valid quantity
    }
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noah's Mac Shack Invoice</title>
</head>
    <body>
      <h1>Noah's Mac Shack Invoice</h1>
        <table border="2">
          <tbody>
            <tr>
              <th style="text-align: center;" width="43%">Item</th>
              <th style="text-align: center;" width="11%">quantity</th>
              <th style="text-align: center;" width="13%">price</th>
              <th style="text-align: center;" width="54%">extended price</th>
            </tr>
<script>
// Modified the for loop from Invoice4 to calculate extended_price & subtotal, for ex: I shortened subtotal = extended_price + subtotal; to subtotal += price
  subtotal = 0;
    for (i = 0; i < products.length; i++) {
      if (quantities[i] > 0) { // If quantities > 0 then perform the expression
        extended_price = quantities[i] * products[i].price;
      subtotal += extended_price; // subtotal = subtotal + extended_price
      document.write(`
        <tr>
          <td width="43%">${products[i].name}</td>
          <td align="center" width="11%">${quantities[i]}</td>
          <td width="13%">\$${products[i].price}</td>
          <td width="54%">\$${extended_price.toFixed(2)}</td>
        </tr>
    `);
  }
}
// Took the following expressions (tax, shipping, grand total) from Invoice4 but modified the values to better fit my product offerings
    // Compute tax
        var tax_rate = 0.045;
        var tax = tax_rate*subtotal;

    // Compute shipping
        if(subtotal <= 250) {
          shipping = 10;
          }
        else if(subtotal <= 750) {
          shipping = 15;
          }
        else {
          shipping = 0.03*subtotal; // 5% of subtotal
          }

    // Compute grand total
        var total = subtotal + tax + shipping; 
</script>
<!--Took the following from Invoice4 but I left everything the same (.toFixed, etc.) b/c all the changes were made in the expressions above-->
        <tr>
            <td colspan="4" width="100%">&nbsp;</td>
        </tr>
        <tr>
            <td style="text-align: center;" colspan="3" width="67%">Sub-total</td>
            <td width="54%">$<script>document.write(subtotal.toFixed(2));</script></td>
        </tr>
        <tr>
            <td style="text-align: center;" colspan="3" width="67%"><span style="font-family: arial;">Tax @ <script>document.write(100*tax_rate);</script>%</span></td>
            <td width="54%">$<script>document.write(tax.toFixed(2));</script></td>
        </tr>
        <tr>
            <td style="text-align: center;" colspan="3" width="67%">Shipping</td>
            <td width="54%">$<script>document.write(shipping.toFixed(2));</script></td>
        </tr>
        <tr>
            <td style="text-align: center;" colspan="3" width="67%"><strong>Total</strong></td>
            <td width="54%"><strong>$<script>document.write(total.toFixed(2));</script></strong></td>
        </tr>
      </tbody>
    </table>
  <div>
<!--Revised the shipping policy from Invoice4 b/c the products I am selling are of a higher value and price range-->
<br><b>
    OUR SHIPPING POLICY IS:
      <br>
      <br>Subtotals ranging from $0 - $249.99 will be $10 shipping.
      <br>Subtotals ranging from $250 - $749.99 will be $20 shipping.
      <br>Subtotals over $750 will be charged 3% of the subtotal amount.
      <br>This is because orders over $750 have 1 or more product(s) that increase both the weight & packaging for the shipment process.<br>
      </b>
    </div> 
  </body>
</html>